<script>
    const startBtn = document.getElementById("startBtn");
    const stopBtn = document.getElementById("stopBtn");
    const helpBtn = document.getElementById("helpBtn");
    const codeDisplay = document.getElementById("codeDisplay");
    const userInput = document.getElementById("userInput");
    const resultText = document.getElementById("resultText");
    const scoreText = document.getElementById("scoreText");
    const timeText = document.getElementById("timeText");
    const guideText = document.getElementById("guideText");

    let generatedCode = "";
    let score = 0;
    let gameActive = false;
    let startTime, intervalID;

    function generateCode(length = 4) {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
      let result = "";
      for (let i = 0; i < length; i++) {
        result += chars.charAt(Math.floor(Math.random() * chars.length));
      }
      return result;
    }

    function startGame() {
      if (gameActive) return;
      gameActive = true;
      score = 0;
      updateScore();
      resultText.textContent = "";
      timeText.textContent = "";
      startBtn.classList.add("hidden");
      stopBtn.classList.remove("hidden");
      guideText.classList.add("hidden");
      startTime = Date.now();
      intervalID = setInterval(updateTime, 1000);
      showCode();
    }

    function showCode() {
      userInput.classList.add("hidden");
      userInput.value = "";
      generatedCode = generateCode();
      codeDisplay.textContent = generatedCode;

      setTimeout(() => {
        codeDisplay.textContent = "";
        userInput.classList.remove("hidden");
        userInput.focus();
      }, 3000);
    }

    function checkAnswer() {
      if (!gameActive) return;
      const answer = userInput.value.toUpperCase();
      if (answer === generatedCode) {
        score += 5;
        resultText.textContent = "✅ To‘g‘ri! +5 ball";
        resultText.className = "text-green-600 font-bold text-xl";
      } else {
        score -= 2;
        resultText.textContent = ❌ Xato! To‘g‘risi: ${generatedCode} (-2 ball);
        resultText.className = "text-red-600 font-bold text-xl";
      }
      updateScore();
      showCode();
    }

    function updateScore() {
      scoreText.textContent = Ball: ${score};
    }

    function stopGame() {
      gameActive = false;
      userInput.classList.add("hidden");
      codeDisplay.textContent = "";
      stopBtn.classList.add("hidden");
      startBtn.classList.remove("hidden");
      resultText.textContent = O‘yin tugadi. Jami ball: ${score};
      resultText.className = "text-indigo-700 font-semibold text-lg";
      updateTime(true);
    }

    function updateTime(final = false) {
      const now = Date.now();
      const diff = now - startTime;
      const mins = Math.floor(diff / 60000);
      const secs = Math.floor((diff % 60000) / 1000);
      timeText.textContent = Davomiyligi: ${mins} daqiqa ${secs} soniya;
      if (final) clearInterval(intervalID);
    }

    startBtn.addEventListener("click", startGame);
    stopBtn.addEventListener("click", stopGame);

    helpBtn.addEventListener("click", () => {
      guideText.classList.toggle("hidden");
    });

    userInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        checkAnswer();
      }
    });
  </script>

</body>
</html>
